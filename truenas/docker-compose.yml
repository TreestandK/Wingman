# TrueNAS SCALE Docker Compose Configuration for Wingman
# This configuration uses bind mounts for TrueNAS storage pools

version: '3.8'

networks:
  wingman-network:
    driver: bridge

services:
  wingman:
    image: ghcr.io/treestandk/wingman:latest
    container_name: wingman-gameserver-manager
    restart: unless-stopped

    ports:
      - '5000:5000'

    networks:
      - wingman-network

    environment:
      # Domain Configuration
      - DOMAIN=treestandk.com

      # Authentication & Security (NEW!)
      # IMPORTANT: Change these default values!
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-changeme}
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY:-please-change-this-secret-key}
      - ENABLE_AUTH=${ENABLE_AUTH:-true}
      - SESSION_COOKIE_SECURE=${SESSION_COOKIE_SECURE:-false}
      - ENABLE_SAML=${ENABLE_SAML:-false}

      # Cloudflare Configuration
      - CF_API_TOKEN=${CF_API_TOKEN:-}
      - CF_ZONE_ID=${CF_ZONE_ID:-}

      # Nginx Proxy Manager Configuration
      - NPM_API_URL=${NPM_API_URL:-}
      - NPM_EMAIL=${NPM_EMAIL:-}
      - NPM_PASSWORD=${NPM_PASSWORD:-}

      # UniFi Configuration
      - UNIFI_URL=${UNIFI_URL:-}
      - UNIFI_USER=${UNIFI_USER:-}
      - UNIFI_PASS=${UNIFI_PASS:-}
      - UNIFI_SITE=${UNIFI_SITE:-default}
      - UNIFI_IS_UDM=${UNIFI_IS_UDM:-false}

      # Pterodactyl Configuration
      - PTERO_URL=${PTERO_URL:-}
      - PTERO_API_KEY=${PTERO_API_KEY:-}

      # Network Configuration
      - PUBLIC_IP=${PUBLIC_IP:-}

      # Feature Flags
      - ENABLE_AUTO_UNIFI=${ENABLE_AUTO_UNIFI:-true}
      - ENABLE_SSL_AUTO=${ENABLE_SSL_AUTO:-true}
      - ENABLE_MONITORING=${ENABLE_MONITORING:-false}

    volumes:
      # TrueNAS SCALE bind mounts
      # IMPORTANT: Update these paths to match your TrueNAS pool
      - /mnt/Extra_Pool/apps/wingman/data:/app/data
      - /mnt/Extra_Pool/apps/wingman/logs:/app/logs
      - /mnt/Extra_Pool/apps/wingman/templates:/app/templates/saved

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
